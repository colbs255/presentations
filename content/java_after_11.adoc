= Java after 11

== What's new?

* Better NullPointerExceptions
* Garbage Collection Improvements
* Text Blocks
* Pattern matching for instanceof
* Switch Expressions
* Records
* Sealed Classes
* And more!

== Beter NullpointerExceptions

[,java]
----
a.b.c.i = 99; // Throws a NullPointerException
----

.Before
[,txt]
----
NullPointerException at Prog.main(Prog.java:5)
----

.After
[,txt]
----
NullPointerException: Cannot read field "c" because "a.b" is null ...
----

== Garbage Collection (GC)

=== GC Trade-offs

[horizontal]
Throughput:: How much time is spent doing actual application work vs GC work?
Latency:: How does GC affect individual app operations?
Footprint:: How much extra memory is needed for the GC?

=== Java GCs

[horizontal]
Serial:: simple, single threaded
Parallel:: throughput
G1 (default):: balance of throughput and latency
Shenandoah:: latency
ZGC:: latency
Epsilon:: no-op collector

=== Java 17 GC Benchmarks

.https://kstefanj.github.io/2021/11/24/gc-progress-8-17.html[Stefan Johansson - GC progress from JDK 8 to JDK 17]
|===
a|

image::https://kstefanj.github.io/assets/posts/gc-8-17/throughput.png[]
a|

image::https://kstefanj.github.io/assets/posts/gc-8-17/latency.png[]
|===

== Text Blocks

.Before
[,java]
----
String grossJson = "{\n\"id\": 1,\n\"qty\": 5,\n\"price\": 100.00}";
----

.After
[,java]
----
String prettyJson = """
            {
                "id": 1,
                "qty": 5,
                "price": 100
            }
            """;
----

== Pattern Matching for instanceof

=== Example 1

.Before
[,java]
----
Object o = someRandomObject();
if (o instanceof String) {
    String s = (String)o;
    // do something with String s...
} else if (o instanceof Number) {
    Number n = (Number)o;
    // do something with Number n...
}
----

.After
[,java]
----
Object o = someRandomObject();
if (o instanceof String s) {
    // do something with String s...
} else if (o instanceof Number n) {
    // do something with Number n...
}
----

=== Example 2

.Before
[,java]
----
public final boolean equals(Object o) {
    if (!(o instanceof Point)) return false;
    Point other = (Point) o;
    return x == other.x && y == other.y;
}
----

.After
[,java]
----
public final boolean equals(Object o) {
    return (o instanceof Point other)
        && x == other.x && y == other.y;
}
----

== Conclusion

* Java 17 improves...
    ** System Performance
        *** Enhanced garbage collectors
    ** Developer Velocity
        *** Better null pointer exceptions
        *** Text blocks, `Stream::toList`
        *** Pattern matching, switch expressions, and records
    ** Developer Flexibility
        *** Sealed classes
        *** Oriented Programming ([Brian Goetz Article](https://www.infoq.com/articles/data-oriented-programming-java))
